@using BigDataSelectorWebClient.Models.TopElementsProvider.Result

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    TopElementsProviderResult topElementsResult = this.ViewBag.TopElementsResult;
}

@if (topElementsResult is PageResult)
{
    var pageResult = topElementsResult as PageResult;
    
    <div class="header">
        <div class="elapsedTime">Elapsed time: @(pageResult.CalculationTime.ToString(@"hh\:mm\:ss"))</div>
        <div class="paging">
            
            @for (int i = 1; i <= pageResult.PagesCount; i++)
            {
                <div class="pagePointer">
                    @if (i == this.ViewBag.CurrentPageNumber)
                    {
                        <span class="active">@i</span>
                    }
                    else
                    {
                        @Html.RouteLink(i.ToString(), new {controller = "Home", action = "Index", pageNumber = i})
                    }
                </div>
            }

        </div>
    </div>
}

<div class="page">

    @if (topElementsResult is FileNotFoundResult)
    {
        <h2>Big file not found</h2>
        <p>Please, specify correct path in Web.config.</p>
    }

    @if (topElementsResult is SelectionInProgressResult)
    {
        var selectionInProgressResult = (SelectionInProgressResult)topElementsResult;

        <h2>Selection in progress</h2>
        <p><span>@selectionInProgressResult.ItemsProcessed.ToString("N0")</span> items processed</p>
        <p>@((DateTime.UtcNow - selectionInProgressResult.StartDate).ToString(@"hh\:mm\:ss"))</p>

        <script type="text/javascript">

            setTimeout(function () {
                window.location = window.location;
            }, 5000);

        </script>
    }

    @if (topElementsResult is PageResult)
    {
        PageResult pageResult = (PageResult)topElementsResult;

        <div class="content">
            <ul class="numbersList">
                @foreach (var page in pageResult.Page)
                {
                    <li>@page</li>
                }
            </ul>
        </div>
    }
    
    @if (topElementsResult is InvalidPageNumberResult)
    {
        <p>Invalid page number</p>
    }

</div>